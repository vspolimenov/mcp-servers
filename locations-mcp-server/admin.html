<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cities MCP Server - Admin Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f7;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1d1d1f;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #1d1d1f;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 16px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056cc;
        }
        button:disabled {
            background: #d2d2d7;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f6f6f6;
            border-radius: 8px;
            font-family: Monaco, 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #1d1d1f;
            color: #f5f5f7;
            border-radius: 8px;
            font-family: Monaco, 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 600;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .quick-tests {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .quick-test-btn {
            background: #28a745;
            font-size: 14px;
            padding: 8px 16px;
        }
        .quick-test-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìç Locations MCP Server - Admin Test Page</h1>

        <div class="test-section">
            <h2>üèôÔ∏è Cities Search (cities/towns/villages)</h2>
            <div class="form-group">
                <label for="citiesSearchTerm">Search Term:</label>
                <input type="text" id="citiesSearchTerm" placeholder="Enter city name (e.g., –°–æ—Ñ–∏—è, –ü–ª–æ–≤–¥–∏–≤)" value="–°–æ—Ñ–∏—è">
            </div>

            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testCitiesQuick('–°–æ—Ñ–∏—è')">–°–æ—Ñ–∏—è</button>
                <button class="quick-test-btn" onclick="testCitiesQuick('–ü–ª–æ–≤–¥–∏–≤')">–ü–ª–æ–≤–¥–∏–≤</button>
                <button class="quick-test-btn" onclick="testCitiesQuick('–í–∞—Ä–Ω–∞')">–í–∞—Ä–Ω–∞</button>
                <button class="quick-test-btn" onclick="testCitiesQuick('–ë—É—Ä–≥–∞—Å')">–ë—É—Ä–≥–∞—Å</button>
            </div>

            <button onclick="testCities()" id="testCitiesBtn">Search Cities</button>
            <button onclick="clearCitiesResults()">Clear Results</button>

            <div id="citiesStatus"></div>
            <div id="citiesResults" class="results" style="display:none;"></div>
            <div id="citiesLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>‚õ∞Ô∏è Mountains Search (peaks/mountain ranges)</h2>
            <div class="form-group">
                <label for="mountainsSearchTerm">Search Term:</label>
                <input type="text" id="mountainsSearchTerm" placeholder="Enter mountain name (e.g., –í–∏—Ç–æ—à–∞, –ú—É—Å–∞–ª–∞)" value="–í–∏—Ç–æ—à–∞">
            </div>

            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testMountainsQuick('–í–∏—Ç–æ—à–∞')">–í–∏—Ç–æ—à–∞</button>
                <button class="quick-test-btn" onclick="testMountainsQuick('–ú—É—Å–∞–ª–∞')">–ú—É—Å–∞–ª–∞</button>
                <button class="quick-test-btn" onclick="testMountainsQuick('–†–∏–ª–∞')">–†–∏–ª–∞</button>
                <button class="quick-test-btn" onclick="testMountainsQuick('–ü–∏—Ä–∏–Ω')">–ü–∏—Ä–∏–Ω</button>
            </div>

            <button onclick="testMountains()" id="testMountainsBtn">Search Mountains</button>
            <button onclick="clearMountainsResults()">Clear Results</button>

            <div id="mountainsStatus"></div>
            <div id="mountainsResults" class="results" style="display:none;"></div>
            <div id="mountainsLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üèûÔ∏è Natural Sites Search (caves/waterfalls)</h2>
            <div class="form-group">
                <label for="naturalSearchTerm">Search Term:</label>
                <input type="text" id="naturalSearchTerm" placeholder="Enter natural site name (e.g., –î–µ–≤–µ—Ç–∞—à–∫–∞ –ø–µ—â–µ—Ä–∞)" value="–î–µ–≤–µ—Ç–∞—à–∫–∞ –ø–µ—â–µ—Ä–∞">
            </div>

            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testNaturalQuick('–î–µ–≤–µ—Ç–∞—à–∫–∞ –ø–µ—â–µ—Ä–∞')">–î–µ–≤–µ—Ç–∞—à–∫–∞ –ø–µ—â–µ—Ä–∞</button>
                <button class="quick-test-btn" onclick="testNaturalQuick('–ö—Ä—É—à—É–Ω—Å–∫–∏ –≤–æ–¥–æ–ø–∞–¥–∏')">–ö—Ä—É—à—É–Ω—Å–∫–∏ –≤–æ–¥–æ–ø–∞–¥–∏</button>
            </div>

            <button onclick="testNaturalSites()" id="testNaturalBtn">Search Natural Sites</button>
            <button onclick="clearNaturalResults()">Clear Results</button>

            <div id="naturalStatus"></div>
            <div id="naturalResults" class="results" style="display:none;"></div>
            <div id="naturalLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üèõÔ∏è Cultural Sites Search (monasteries/castles/museums)</h2>
            <div class="form-group">
                <label for="culturalSearchTerm">Search Term:</label>
                <input type="text" id="culturalSearchTerm" placeholder="Enter cultural site name (e.g., –†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä)" value="–†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä">
            </div>

            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testCulturalQuick('–†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä')">–†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä</button>
                <button class="quick-test-btn" onclick="testCulturalQuick('–¶–∞—Ä–µ–≤–µ—Ü')">–¶–∞—Ä–µ–≤–µ—Ü</button>
                <button class="quick-test-btn" onclick="testCulturalQuick('–ë—É–∑–ª—É–¥–∂–∞')">–ë—É–∑–ª—É–¥–∂–∞</button>
            </div>

            <button onclick="testCulturalSites()" id="testCulturalBtn">Search Cultural Sites</button>
            <button onclick="clearCulturalResults()">Clear Results</button>

            <div id="culturalStatus"></div>
            <div id="culturalResults" class="results" style="display:none;"></div>
            <div id="culturalLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üîç General Overpass API Test</h2>
            <div class="form-group">
                <label for="searchTerm">Search Term:</label>
                <input type="text" id="searchTerm" placeholder="Enter location name" value="–°–æ—Ñ–∏—è">
            </div>

            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testQuick('–°–æ—Ñ–∏—è')">–°–æ—Ñ–∏—è</button>
                <button class="quick-test-btn" onclick="testQuick('–í–∏—Ç–æ—à–∞')">–í–∏—Ç–æ—à–∞</button>
                <button class="quick-test-btn" onclick="testQuick('–†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä')">–†–∏–ª—Å–∫–∏ –º–∞–Ω–∞—Å—Ç–∏—Ä</button>
            </div>

            <button onclick="testOverpass()" id="testBtn">Test Overpass API</button>
            <button onclick="clearResults()">Clear Results</button>

            <div id="status"></div>
            <div id="results" class="results" style="display:none;"></div>
            <div id="log" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üìñ Wikipedia API Test</h2>
            <div class="form-group">
                <label for="wikipediaTag">Wikipedia Tag (format: lang:title):</label>
                <input type="text" id="wikipediaTag" placeholder="Enter Wikipedia tag (e.g., en:Sofia, bg:–°–æ—Ñ–∏—è)" value="en:Sofia">
            </div>
            
            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testWikipediaQuick('en:Sofia')">en:Sofia</button>
                <button class="quick-test-btn" onclick="testWikipediaQuick('bg:–°–æ—Ñ–∏—è')">bg:–°–æ—Ñ–∏—è</button>
                <button class="quick-test-btn" onclick="testWikipediaQuick('en:Plovdiv')">en:Plovdiv</button>
                <button class="quick-test-btn" onclick="testWikipediaQuick('bg:–ü–ª–æ–≤–¥–∏–≤')">bg:–ü–ª–æ–≤–¥–∏–≤</button>
                <button class="quick-test-btn" onclick="testWikipediaQuick('en:Vitosha')">en:Vitosha</button>
                <button class="quick-test-btn" onclick="testWikipediaQuick('bg:–í–∏—Ç–æ—à–∞')">bg:–í–∏—Ç–æ—à–∞</button>
            </div>
            
            <button onclick="testWikipedia()" id="testWikipediaBtn">Test Wikipedia API</button>
            <button onclick="clearWikipediaResults()">Clear Results</button>
            
            <div id="wikipediaStatus"></div>
            <div id="wikipediaResults" class="results" style="display:none;"></div>
            <div id="wikipediaLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üåê Wikidata API Test</h2>
            <div class="form-group">
                <label for="wikidataId">Wikidata ID (format: Q...):</label>
                <input type="text" id="wikidataId" placeholder="Enter Wikidata ID (e.g., Q472, Q6506)" value="Q472">
            </div>
            
            <div class="quick-tests">
                <button class="quick-test-btn" onclick="testWikidataQuick('Q472')">Q472 (Sofia)</button>
                <button class="quick-test-btn" onclick="testWikidataQuick('Q6506')">Q6506 (Plovdiv)</button>
                <button class="quick-test-btn" onclick="testWikidataQuick('Q209851')">Q209851 (Vitosha)</button>
                <button class="quick-test-btn" onclick="testWikidataQuick('Q219')">Q219 (Bulgaria)</button>
            </div>
            
            <button onclick="testWikidata()" id="testWikidataBtn">Test Wikidata API</button>
            <button onclick="clearWikidataResults()">Clear Results</button>
            
            <div id="wikidataStatus"></div>
            <div id="wikidataResults" class="results" style="display:none;"></div>
            <div id="wikidataLog" class="log" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üìä Service Statistics</h2>
            <div id="stats">
                <p><strong>Total Requests:</strong> <span id="totalRequests">0</span></p>
                <p><strong>Successful Requests:</strong> <span id="successfulRequests">0</span></p>
                <p><strong>Failed Requests:</strong> <span id="failedRequests">0</span></p>
                <p><strong>Average Response Time:</strong> <span id="avgResponseTime">-</span></p>
            </div>
        </div>
    </div>

    <script>
        let stats = {
            total: 0,
            successful: 0,
            failed: 0,
            responseTimes: []
        };

        function updateStats() {
            document.getElementById('totalRequests').textContent = stats.total;
            document.getElementById('successfulRequests').textContent = stats.successful;
            document.getElementById('failedRequests').textContent = stats.failed;
            
            const avgTime = stats.responseTimes.length > 0 
                ? (stats.responseTimes.reduce((a,b) => a + b, 0) / stats.responseTimes.length).toFixed(2) + 'ms'
                : '-';
            document.getElementById('avgResponseTime').textContent = avgTime;
        }

        function setStatus(message, type = 'loading') {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showResults(data) {
            const resultsEl = document.getElementById('results');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testQuick(term) {
            document.getElementById('searchTerm').value = term;
            testOverpass();
        }

        async function testOverpass() {
            const searchTerm = document.getElementById('searchTerm').value.trim();
            if (!searchTerm) {
                setStatus('Please enter a search term', 'error');
                return;
            }

            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;
            
            setStatus(`üîç Searching for "${searchTerm}"...`, 'loading');
            log(`Starting search for: "${searchTerm}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                // Since we can't directly import the service in browser, 
                // we'll simulate the API call structure
                const response = await fetch('/api/test-overpass', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ searchTerm })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                stats.successful++;
                setStatus(`‚úÖ Found ${data.results?.length || 0} results (${responseTime.toFixed(2)}ms)`, 'success');
                log(`Success! Found ${data.results?.length || 0} results in ${responseTime.toFixed(2)}ms`);
                showResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);
                
                stats.failed++;
                setStatus(`‚ùå Error: ${error.message}`, 'error');
                log(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showResults({ error: error.message, stack: error.stack });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('log').style.display = 'none';
            document.getElementById('log').textContent = '';
            document.getElementById('status').innerHTML = '';
        }

        // Wikipedia helper functions
        function setWikipediaStatus(message, type = 'loading') {
            const statusEl = document.getElementById('wikipediaStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logWikipedia(message) {
            const logEl = document.getElementById('wikipediaLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showWikipediaResults(data) {
            const resultsEl = document.getElementById('wikipediaResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testWikipediaQuick(tag) {
            document.getElementById('wikipediaTag').value = tag;
            testWikipedia();
        }

        async function testWikipedia() {
            const wikipediaTag = document.getElementById('wikipediaTag').value.trim();
            if (!wikipediaTag) {
                setWikipediaStatus('Please enter a Wikipedia tag', 'error');
                return;
            }

            const testBtn = document.getElementById('testWikipediaBtn');
            testBtn.disabled = true;
            
            setWikipediaStatus(`üìñ Looking up "${wikipediaTag}"...`, 'loading');
            logWikipedia(`Starting Wikipedia lookup for: "${wikipediaTag}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-wikipedia', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ wikipediaTag })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                stats.successful++;
                const hasResult = data.result && Object.keys(data.result).length > 0;
                setWikipediaStatus(`‚úÖ ${hasResult ? 'Found data' : 'No data found'} (${responseTime.toFixed(2)}ms)`, 'success');
                logWikipedia(`Success! ${hasResult ? 'Found Wikipedia data' : 'No data found'} in ${responseTime.toFixed(2)}ms`);
                showWikipediaResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);
                
                stats.failed++;
                setWikipediaStatus(`‚ùå Error: ${error.message}`, 'error');
                logWikipedia(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showWikipediaResults({ error: error.message, stack: error.stack });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearWikipediaResults() {
            document.getElementById('wikipediaResults').style.display = 'none';
            document.getElementById('wikipediaLog').style.display = 'none';
            document.getElementById('wikipediaLog').textContent = '';
            document.getElementById('wikipediaStatus').innerHTML = '';
        }

        // Wikidata helper functions
        function setWikidataStatus(message, type = 'loading') {
            const statusEl = document.getElementById('wikidataStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logWikidata(message) {
            const logEl = document.getElementById('wikidataLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showWikidataResults(data) {
            const resultsEl = document.getElementById('wikidataResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testWikidataQuick(id) {
            document.getElementById('wikidataId').value = id;
            testWikidata();
        }

        async function testWikidata() {
            const wikidataId = document.getElementById('wikidataId').value.trim();
            if (!wikidataId) {
                setWikidataStatus('Please enter a Wikidata ID', 'error');
                return;
            }

            const testBtn = document.getElementById('testWikidataBtn');
            testBtn.disabled = true;
            
            setWikidataStatus(`üåê Looking up "${wikidataId}"...`, 'loading');
            logWikidata(`Starting Wikidata lookup for: "${wikidataId}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-wikidata', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ wikidataId })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                stats.successful++;
                const hasResult = data.result && Object.keys(data.result).length > 0;
                setWikidataStatus(`‚úÖ ${hasResult ? 'Found data' : 'No data found'} (${responseTime.toFixed(2)}ms)`, 'success');
                logWikidata(`Success! ${hasResult ? 'Found Wikidata information' : 'No data found'} in ${responseTime.toFixed(2)}ms`);
                showWikidataResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);
                
                stats.failed++;
                setWikidataStatus(`‚ùå Error: ${error.message}`, 'error');
                logWikidata(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showWikidataResults({ error: error.message, stack: error.stack });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearWikidataResults() {
            document.getElementById('wikidataResults').style.display = 'none';
            document.getElementById('wikidataLog').style.display = 'none';
            document.getElementById('wikidataLog').textContent = '';
            document.getElementById('wikidataStatus').innerHTML = '';
        }

        // Cities search functions
        function setCitiesStatus(message, type = 'loading') {
            const statusEl = document.getElementById('citiesStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logCities(message) {
            const logEl = document.getElementById('citiesLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showCitiesResults(data) {
            const resultsEl = document.getElementById('citiesResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testCitiesQuick(term) {
            document.getElementById('citiesSearchTerm').value = term;
            testCities();
        }

        async function testCities() {
            const searchTerm = document.getElementById('citiesSearchTerm').value.trim();
            if (!searchTerm) {
                setCitiesStatus('Please enter a search term', 'error');
                return;
            }

            const testBtn = document.getElementById('testCitiesBtn');
            testBtn.disabled = true;

            setCitiesStatus(`üèôÔ∏è Searching for city "${searchTerm}"...`, 'loading');
            logCities(`Starting cities search for: "${searchTerm}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-cities', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ searchTerm })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                stats.successful++;
                setCitiesStatus(`‚úÖ Found ${data.count || 0} cities (${responseTime.toFixed(2)}ms)`, 'success');
                logCities(`Success! Found ${data.count || 0} cities in ${responseTime.toFixed(2)}ms`);
                showCitiesResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                stats.failed++;
                setCitiesStatus(`‚ùå Error: ${error.message}`, 'error');
                logCities(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showCitiesResults({ error: error.message });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearCitiesResults() {
            document.getElementById('citiesResults').style.display = 'none';
            document.getElementById('citiesLog').style.display = 'none';
            document.getElementById('citiesLog').textContent = '';
            document.getElementById('citiesStatus').innerHTML = '';
        }

        // Mountains search functions
        function setMountainsStatus(message, type = 'loading') {
            const statusEl = document.getElementById('mountainsStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logMountains(message) {
            const logEl = document.getElementById('mountainsLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showMountainsResults(data) {
            const resultsEl = document.getElementById('mountainsResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testMountainsQuick(term) {
            document.getElementById('mountainsSearchTerm').value = term;
            testMountains();
        }

        async function testMountains() {
            const searchTerm = document.getElementById('mountainsSearchTerm').value.trim();
            if (!searchTerm) {
                setMountainsStatus('Please enter a search term', 'error');
                return;
            }

            const testBtn = document.getElementById('testMountainsBtn');
            testBtn.disabled = true;

            setMountainsStatus(`‚õ∞Ô∏è Searching for mountain "${searchTerm}"...`, 'loading');
            logMountains(`Starting mountains search for: "${searchTerm}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-mountains', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ searchTerm })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                stats.successful++;
                setMountainsStatus(`‚úÖ Found ${data.count || 0} mountains (${responseTime.toFixed(2)}ms)`, 'success');
                logMountains(`Success! Found ${data.count || 0} mountains in ${responseTime.toFixed(2)}ms`);
                showMountainsResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                stats.failed++;
                setMountainsStatus(`‚ùå Error: ${error.message}`, 'error');
                logMountains(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showMountainsResults({ error: error.message });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearMountainsResults() {
            document.getElementById('mountainsResults').style.display = 'none';
            document.getElementById('mountainsLog').style.display = 'none';
            document.getElementById('mountainsLog').textContent = '';
            document.getElementById('mountainsStatus').innerHTML = '';
        }

        // Natural sites search functions
        function setNaturalStatus(message, type = 'loading') {
            const statusEl = document.getElementById('naturalStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logNatural(message) {
            const logEl = document.getElementById('naturalLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showNaturalResults(data) {
            const resultsEl = document.getElementById('naturalResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testNaturalQuick(term) {
            document.getElementById('naturalSearchTerm').value = term;
            testNaturalSites();
        }

        async function testNaturalSites() {
            const searchTerm = document.getElementById('naturalSearchTerm').value.trim();
            if (!searchTerm) {
                setNaturalStatus('Please enter a search term', 'error');
                return;
            }

            const testBtn = document.getElementById('testNaturalBtn');
            testBtn.disabled = true;

            setNaturalStatus(`üèûÔ∏è Searching for natural site "${searchTerm}"...`, 'loading');
            logNatural(`Starting natural sites search for: "${searchTerm}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-natural-sites', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ searchTerm })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                stats.successful++;
                setNaturalStatus(`‚úÖ Found ${data.count || 0} natural sites (${responseTime.toFixed(2)}ms)`, 'success');
                logNatural(`Success! Found ${data.count || 0} natural sites in ${responseTime.toFixed(2)}ms`);
                showNaturalResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                stats.failed++;
                setNaturalStatus(`‚ùå Error: ${error.message}`, 'error');
                logNatural(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showNaturalResults({ error: error.message });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearNaturalResults() {
            document.getElementById('naturalResults').style.display = 'none';
            document.getElementById('naturalLog').style.display = 'none';
            document.getElementById('naturalLog').textContent = '';
            document.getElementById('naturalStatus').innerHTML = '';
        }

        // Cultural sites search functions
        function setCulturalStatus(message, type = 'loading') {
            const statusEl = document.getElementById('culturalStatus');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function logCultural(message) {
            const logEl = document.getElementById('culturalLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.style.display = 'block';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function showCulturalResults(data) {
            const resultsEl = document.getElementById('culturalResults');
            resultsEl.textContent = JSON.stringify(data, null, 2);
            resultsEl.style.display = 'block';
        }

        function testCulturalQuick(term) {
            document.getElementById('culturalSearchTerm').value = term;
            testCulturalSites();
        }

        async function testCulturalSites() {
            const searchTerm = document.getElementById('culturalSearchTerm').value.trim();
            if (!searchTerm) {
                setCulturalStatus('Please enter a search term', 'error');
                return;
            }

            const testBtn = document.getElementById('testCulturalBtn');
            testBtn.disabled = true;

            setCulturalStatus(`üèõÔ∏è Searching for cultural site "${searchTerm}"...`, 'loading');
            logCultural(`Starting cultural sites search for: "${searchTerm}"`);

            stats.total++;
            const startTime = performance.now();

            try {
                const response = await fetch('/api/test-cultural-sites', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ searchTerm })
                });

                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                stats.successful++;
                setCulturalStatus(`‚úÖ Found ${data.count || 0} cultural sites (${responseTime.toFixed(2)}ms)`, 'success');
                logCultural(`Success! Found ${data.count || 0} cultural sites in ${responseTime.toFixed(2)}ms`);
                showCulturalResults(data);

            } catch (error) {
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                stats.responseTimes.push(responseTime);

                stats.failed++;
                setCulturalStatus(`‚ùå Error: ${error.message}`, 'error');
                logCultural(`Error after ${responseTime.toFixed(2)}ms: ${error.message}`);
                showCulturalResults({ error: error.message });
            }

            updateStats();
            testBtn.disabled = false;
        }

        function clearCulturalResults() {
            document.getElementById('culturalResults').style.display = 'none';
            document.getElementById('culturalLog').style.display = 'none';
            document.getElementById('culturalLog').textContent = '';
            document.getElementById('culturalStatus').innerHTML = '';
        }

        // Initialize
        updateStats();
        log('Admin page loaded and ready for testing: Cities, Mountains, Natural Sites, Cultural Sites, Wikipedia, and Wikidata');
    </script>
</body>
</html>